<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="PDF Tips" suffix=" | AI Knowledge Platform">
      {assigns[:page_title]}
    </.live_title>
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
    <script>
      (() => {
        const stored = localStorage.getItem("phx:theme");
        const theme = stored || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        document.documentElement.setAttribute("data-theme", theme);

        window.addEventListener("storage", (e) => {
          if (e.key === "phx:theme") {
            document.documentElement.setAttribute("data-theme", e.newValue || "dark");
          }
        });
      })();
    </script>
  </head>
  <body class="bg-base-200 min-h-screen">
    <div class="flex min-h-screen">
      <!-- Sidebar - Carbon Shell style -->
      <aside class="w-56 bg-base-100 border-r border-base-300 flex flex-col fixed h-full">
        <!-- Logo header -->
        <div class="h-12 flex items-center px-4 border-b border-base-300 bg-base-200/50">
          <a href="/" class="flex items-center gap-2">
            <.carbon_icon name="cube" class="w-5 h-5 text-primary" />
            <span class="text-sm font-semibold text-base-content tracking-tight">PDF Tips</span>
          </a>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 py-2 overflow-y-auto">
          <a href="/" class="sidebar-nav-item" data-nav="dashboard">
            <.carbon_icon name="dashboard" class="w-5 h-5 flex-shrink-0" />
            <span>Dashboard</span>
          </a>

          <a href="/documents" class="sidebar-nav-item" data-nav="documents">
            <.carbon_icon name="document" class="w-5 h-5 flex-shrink-0" />
            <span>Documents</span>
          </a>

          <a href="/tips" class="sidebar-nav-item" data-nav="tips">
            <.carbon_icon name="idea" class="w-5 h-5 flex-shrink-0" />
            <span>Tips</span>
          </a>

          <div class="mt-4 pt-4 border-t border-base-300">
            <p class="px-4 mb-1 text-[10px] font-medium text-base-content/40 uppercase tracking-widest">System</p>
            <a href="/settings" class="sidebar-nav-item" data-nav="settings">
              <.carbon_icon name="settings" class="w-5 h-5 flex-shrink-0" />
              <span>Settings</span>
            </a>
          </div>
        </nav>

        <!-- Theme toggle footer -->
        <div class="p-3 border-t border-base-300">
          <button
            onclick="toggleTheme()"
            class="w-full flex items-center gap-2 px-3 py-2 text-xs text-base-content/60 hover:text-base-content hover:bg-base-300/40 transition-colors"
          >
            <span class="hidden dark:block"><.carbon_icon name="light" class="w-4 h-4" /></span>
            <span class="block dark:hidden"><.carbon_icon name="asleep" class="w-4 h-4" /></span>
            <span class="hidden dark:inline">Light mode</span>
            <span class="inline dark:hidden">Dark mode</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="flex-1 ml-56 min-w-0 overflow-x-hidden">
        <!-- Top Header - Carbon UI Shell style -->
        <header class="h-12 bg-base-100 border-b border-base-300 flex items-center justify-between px-4 sticky top-0 z-10">
          <div class="flex items-center gap-3">
            <span class="text-sm font-medium text-base-content">
              {assigns[:page_title] || "Dashboard"}
            </span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs text-base-content/50 uppercase tracking-wider">AI Knowledge Platform</span>
          </div>
        </header>

        <!-- Page Content -->
        <main class="p-4 max-w-full">
          <!-- Flash Messages -->
          <div id="flash-container" class="mb-4 space-y-2">
            <%= if info = Phoenix.Flash.get(@flash, :info) do %>
              <div class="flash-info" role="alert">
                <.carbon_icon name="information-filled" class="w-5 h-5 flex-shrink-0 text-info" />
                <span class="text-sm"><%= info %></span>
              </div>
            <% end %>
            <%= if error = Phoenix.Flash.get(@flash, :error) do %>
              <div class="flash-error" role="alert">
                <.carbon_icon name="warning-filled" class="w-5 h-5 flex-shrink-0 text-error" />
                <span class="text-sm"><%= error %></span>
              </div>
            <% end %>
          </div>

          {@inner_content}
        </main>
      </div>
    </div>

    <script>
      function toggleTheme() {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('phx:theme', next);
      }

      document.addEventListener('DOMContentLoaded', function() {
        const path = window.location.pathname;
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
          const nav = item.getAttribute('data-nav');
          const isActive =
            (nav === 'dashboard' && path === '/') ||
            (nav === 'documents' && path.startsWith('/documents')) ||
            (nav === 'tips' && path.startsWith('/tips')) ||
            (nav === 'settings' && path.startsWith('/settings'));
          item.classList.toggle('active', isActive);
        });
      });

      window.addEventListener('phx:navigate', function() {
        setTimeout(function() {
          const path = window.location.pathname;
          document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            const nav = item.getAttribute('data-nav');
            const isActive =
              (nav === 'dashboard' && path === '/') ||
              (nav === 'documents' && path.startsWith('/documents')) ||
              (nav === 'tips' && path.startsWith('/tips')) ||
              (nav === 'settings' && path.startsWith('/settings'));
            item.classList.toggle('active', isActive);
          });
        }, 50);
      });
    </script>
  </body>
</html>
